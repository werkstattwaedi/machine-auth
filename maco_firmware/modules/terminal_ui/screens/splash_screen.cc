// Copyright Offene Werkstatt WÃ¤denswil
// SPDX-License-Identifier: MIT

#include "maco_firmware/modules/terminal_ui/screens/splash_screen.h"

#include "lvgl.h"
#include "maco_firmware/modules/terminal_ui/theme.h"
#include "pw_log/log.h"

// LVGL image declaration (generated by lvgl_image rule)
LV_IMAGE_DECLARE(oww_logo);

namespace maco::terminal_ui {

SplashScreen::SplashScreen() : Screen("Splash") {}

pw::Status SplashScreen::OnActivate() {
  lv_screen_ = lv_obj_create(nullptr);
  if (!lv_screen_) {
    return pw::Status::Internal();
  }

  lv_obj_set_style_bg_color(
      lv_screen_, lv_color_hex(theme::kColorWhiteBg), LV_PART_MAIN);
  lv_obj_set_style_border_width(lv_screen_, 0, LV_PART_MAIN);

  // OWW logo centered
  lv_obj_t* logo = lv_image_create(lv_screen_);
  lv_image_set_src(logo, &oww_logo);
  lv_obj_center(logo);

  // "Starte..." label near the bottom
  lv_obj_t* subtitle = lv_label_create(lv_screen_);
  lv_label_set_text(subtitle, "Starte...");
  lv_obj_set_style_text_color(
      subtitle, lv_color_hex(theme::kColorMuted), LV_PART_MAIN);
  lv_obj_set_style_text_font(subtitle, &roboto_12, LV_PART_MAIN);
  lv_obj_align(subtitle, LV_ALIGN_BOTTOM_MID, 0, -16);

  PW_LOG_INFO("SplashScreen activated");
  return pw::OkStatus();
}

void SplashScreen::OnDeactivate() {
  // lv_screen_ is not deleted here - LVGL's auto_del in
  // lv_screen_load_anim() handles cleanup after the crossfade.
  lv_screen_ = nullptr;
  PW_LOG_INFO("SplashScreen deactivated");
}

}  // namespace maco::terminal_ui
